#!/usr/bin/env Rscript

library(RCurl)

token <- "9C5F7D13A99C4CB606335649B7D2858D"
url <- "https://redcap.ucsf.edu/api/"
result <- postForm(uri = url,"token"=token,
                 content='record',
                 action='export',
                 format='csv',
                 type='flat',
                 csvDelimiter='',
                 'fields[0]'='student_tracking_id',
                 'fields[1]'='age',
                 'fields[2]'='sex',
                 'fields[3]'='school',
                 'fields[4]'='teacher',
                 'fields[5]'='grade',
                 'fields[6]'='race',
                 'fields[7]'='ethnicity',
                 'fields[8]'='incomplete_data',
                 'fields[9]'='sped',
                 'fields[10]'='noenroll',
                 'fields[11]'='if_other',
                 'fields[12]'='elpac_score',
                 'fields[13]'='selpac_score',
                 'fields[14]'='ell',
                 'fields[15]'='native_lang',
                 'fields[16]'='comments',
                 'fields[17]'='demographics_complete',
                 'fields[18]'='ble_ucat',
                 'fields[19]'='del_ucat',
                 'fields[20]'='evo_ucat',
                 'fields[21]'='nre_ucat',
                 'fields[22]'='nwr_ucat',
                 'fields[23]'='rvo_ucat',
                 'fields[24]'='srt_ucat',
                 'fields[25]'='wre_ucat',
                 'fields[26]'='lsi_ucat',
                 'fields[27]'='lco',
                 'fields[28]'='rao',
                 'fields[29]'='lnc',
                 'fields[30]'='dgs',
                 'fields[31]'='ngs_measures_complete',
                 'fields[32]'='ktea_lw',
                 'fields[33]'='ktea_ns',
                 'fields[34]'='ktea_complete',
                 'fields[35]'='celf_5_sentence_comp',
                 'fields[36]'='celf_5_recalling_sentences',
                 'fields[37]'='wppsi_4_picture_naming',
                 'fields[38]'='wppsi_4_receptive_vocab',
                 'fields[39]'='ctopp_2_memory_for_digits',
                 'fields[40]'='ctopp_2_nonword_repetition',
                 'fields[41]'='ctopp_2_elision',
                 'fields[42]'='ctopp_rapid_letter_naming',
                 'fields[43]'='ctopp_2_rapid_object_namin',
                 'fields[44]'='ctopp_2_blending_words',
                 'fields[45]'='gold_standard_measures_complete',
                 'fields[46]'='survey_relationship',
                 'fields[47]'='survey_ifother_relation',
                 'fields[48]'='survey_age',
                 'fields[49]'='survey_gender',
                 'fields[50]'='survey_background',
                 'fields[51]'='survey_ifother_background',
                 'fields[52]'='survey_preschool',
                 'fields[53]'='survey_speech',
                 'fields[54]'='survey_504plan',
                 'fields[55]'='survey_iep',
                 'fields[56]'='survey_repeatgrd',
                 'fields[57]'='survey_tutor',
                 'fields[58]'='survey_reading',
                 'fields[59]'='survey_sitstill',
                 'fields[60]'='survey_home_eng',
                 'fields[61]'='survey_home_lang',
                 'fields[62]'='survey_lang1',
                 'fields[63]'='survey_lang2',
                 'fields[64]'='survey_lang3',
                 'fields[65]'='survey_lang1_hearfreq',
                 'fields[66]'='survey_lang1_speakfreq',
                 'fields[67]'='survey_lang2_hearfreq',
                 'fields[68]'='survey_lang2_speakfreq',
                 'fields[69]'='survey_lang3_hearfreq',
                 'fields[70]'='survey_lang3_speakfreq',
                 'fields[71]'='survey_0_3lang',
                 'fields[72]'='survey_enjoyread',
                 'fields[73]'='survey_indepread',
                 'fields[74]'='survey_interestread',
                 'fields[75]'='survey_books',
                 'fields[76]'='survey_respondedu',
                 'fields[77]'='survey_famreading',
                 'fields[78]'='survey_covidschool',
                 'fields[79]'='survey_covideffect',
                 'fields[80]'='survey_headinjury',
                 'fields[81]'='study_comments',
                 'fields[82]'='family_questionnaire_complete',
                 'events[0]'='fall2021_arm_1',
                 'events[1]'='winter2022_arm_1',
                 'events[2]'='spring2022_arm_1',
                 rawOrLabel='raw',
                 rawOrLabelHeaders='raw',
                 exportCheckboxLabel='false',
                 exportSurveyFields='false',
                 exportDataAccessGroups='false',
                 returnFormat='csv'
)

con <- textConnection(result)
df <- read.csv(con)
df